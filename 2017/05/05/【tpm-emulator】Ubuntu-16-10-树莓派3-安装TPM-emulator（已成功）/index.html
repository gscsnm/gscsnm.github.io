<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/shinubi128_128.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/shinubi128_128.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/shinubi128_128.ico?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="tpm_emulator 可信计算," />










<meta name="description" content="注：2017-7-14更新  0. 序最近搞可信计算方面，需要使用tpm模拟器，查阅不少资料，也看到了网上的教程。现将自己的安装步骤写个备注，方便自己查看。也希望对看官有所帮助。开干。 —原创水印：https://gscsnm.github.io/—  1. 环境vmware 12Ubuntu 16.10 桌面版 （服务器版也行）  2. 安装cmakesudo apt-get install c">
<meta name="keywords" content="tpm_emulator 可信计算">
<meta property="og:type" content="article">
<meta property="og:title" content="【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功）">
<meta property="og:url" content="http://yoursite.com/2017/05/05/【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功）/index.html">
<meta property="og:site_name" content="い十指演绎生活〃">
<meta property="og:description" content="注：2017-7-14更新  0. 序最近搞可信计算方面，需要使用tpm模拟器，查阅不少资料，也看到了网上的教程。现将自己的安装步骤写个备注，方便自己查看。也希望对看官有所帮助。开干。 —原创水印：https://gscsnm.github.io/—  1. 环境vmware 12Ubuntu 16.10 桌面版 （服务器版也行）  2. 安装cmakesudo apt-get install c">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://img.blog.csdn.net/20170505105013081?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3Njc25t/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:updated_time" content="2018-09-21T05:07:09.106Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功）">
<meta name="twitter:description" content="注：2017-7-14更新  0. 序最近搞可信计算方面，需要使用tpm模拟器，查阅不少资料，也看到了网上的教程。现将自己的安装步骤写个备注，方便自己查看。也希望对看官有所帮助。开干。 —原创水印：https://gscsnm.github.io/—  1. 环境vmware 12Ubuntu 16.10 桌面版 （服务器版也行）  2. 安装cmakesudo apt-get install c">
<meta name="twitter:image" content="http://img.blog.csdn.net/20170505105013081?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3Njc25t/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/05/05/【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功）/"/>





  <title>【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功） | い十指演绎生活〃</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8c30395e53c089139c092a7b8b4dc590";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">い十指演绎生活〃</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="い十指演绎生活〃">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/shinubi.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="い十指演绎生活〃">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【tpm-emulator】Ubuntu-16-10-树莓派3-安装TPM-emulator（已成功）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T14:23:52+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>注：2017-7-14更新</p>
<hr>
<h1 id="0-序"><a href="#0-序" class="headerlink" title="0. 序"></a>0. 序</h1><p>最近搞可信计算方面，需要使用tpm模拟器，查阅不少资料，也看到了网上的教程。现将自己的安装步骤写个备注，方便自己查看。也希望对看官有所帮助。开干。</p>
<p>—<em>原创水印：<a href="https://gscsnm.github.io/" target="_blank" rel="noopener">https://gscsnm.github.io/</a></em>—</p>
<hr>
<h1 id="1-环境"><a href="#1-环境" class="headerlink" title="1. 环境"></a>1. 环境</h1><p>vmware 12<br>Ubuntu 16.10 桌面版 （服务器版也行）</p>
<hr>
<h1 id="2-安装cmake"><a href="#2-安装cmake" class="headerlink" title="2. 安装cmake"></a>2. 安装cmake</h1><pre><code>sudo apt-get install cmake
</code></pre><a id="more"></a>
<h1 id="3-安装GNU-MP-library"><a href="#3-安装GNU-MP-library" class="headerlink" title="3. 安装GNU MP library"></a>3. 安装GNU MP library</h1><p>两种方式安装：apt-get 、源码</p>
<h3 id="3-1-apt-get-安装-（推荐）"><a href="#3-1-apt-get-安装-（推荐）" class="headerlink" title="3.1 apt-get 安装 （推荐）"></a>3.1 apt-get 安装 （推荐）</h3><p>3.1.1 切换用户到root（原谅我……）：<br>​<br>    su</p>
<p>3.1.2 搜索libgmp：   </p>
<pre><code>apt-cache search libgmp
</code></pre><p><img src="http://img.blog.csdn.net/20170505105013081?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3Njc25t/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>3.1.3 上图中很多gmp的库，我安装的是libgmp3-dev：</p>
<pre><code>apt-get -y install libgmp3-dev
</code></pre><h3 id="3-2-源码安装"><a href="#3-2-源码安装" class="headerlink" title="3.2 源码安装"></a>3.2 源码安装</h3><p>官网：<a href="https://gmplib.org/" target="_blank" rel="noopener">https://gmplib.org/</a><br>下载 gmp-5.0.5.tar.bz2</p>
<pre><code>tar -jxf gmp-5.0.5.tar.bz2
./configure
make
make check
make install
</code></pre><p>具体可以看INSTALL和README。</p>
<h1 id="4-安装TPM-emulator"><a href="#4-安装TPM-emulator" class="headerlink" title="4. 安装TPM_emulator"></a>4. 安装TPM_emulator</h1><p>官网应该是： <a href="https://developer.berlios.de" target="_blank" rel="noopener">https://developer.berlios.de</a> ，现在已经打不开了。<br>我GitHub上有源码,tpm_emulator-0.7.4：<br><a href="https://github.com/gscsnm/tpm-emulator" target="_blank" rel="noopener">https://github.com/gscsnm/tpm-emulator</a><br>这个是我从PeterHuewe那儿fork的，用这个就行，这个是修改后的，如果用官方的话，会报错。<br>原因：tpm_emulator还是2011年那会儿开发的，那会linux内核还是3.xxx  ,现在linux内核更新后，net.h里面的一些函数也进行了更新，所以报错。<br>—<em>原创水印：<a href="https://gscsnm.github.io/" target="_blank" rel="noopener">https://gscsnm.github.io/</a></em>—</p>
<h3 id="4-1-下载"><a href="#4-1-下载" class="headerlink" title="4.1 下载"></a>4.1 下载</h3><pre><code> https://github.com/gscsnm/tpm-emulator/archive/master.zip

wget https://github.com/gscsnm/tpm-emulator/archive/master.zip
</code></pre><h3 id="4-2-解压"><a href="#4-2-解压" class="headerlink" title="4.2 解压"></a>4.2 解压</h3><pre><code>unzip master.zip
</code></pre><p>如果没有unzip，请安装。apt-get install unzip</p>
<h3 id="4-3-安装"><a href="#4-3-安装" class="headerlink" title="4.3 安装"></a>4.3 安装</h3><pre><code>cd tpm-emulator-master/
mkdir build;cd build
cmake ../
make
sudo make install

----
make install的时候需要root权限复制文件。
参考README文件
** 如果遇到错误，看文章结尾的错误记录。 **
</code></pre><h3 id="4-4-初始化、启动TPM-emulator"><a href="#4-4-初始化、启动TPM-emulator" class="headerlink" title="4.4 初始化、启动TPM_emulator"></a>4.4 初始化、启动TPM_emulator</h3><p>初始化tpm：</p>
<pre><code>tpmd deactivated
killall tpmd
tpmd clear    
</code></pre><p>启动tpm：  </p>
<pre><code>depmod -a
modprobe tpmd_dev
tpmd -f -d
</code></pre><p>tpmd -h：可以查看启动参数<br>如果启动出错，可以用  <code>tpmd –f –d clear</code></p>
<p>错误：<code>failed: address already in use</code><br>解决：运行命令<code>rm /var/run/tpm/tpmd_socket:0</code></p>
<p>如果成功，会不断打印：</p>
<p>Debug: waiting for connections…</p>
<h3 id="tpm-emulator-安装成功。"><a href="#tpm-emulator-安装成功。" class="headerlink" title="tpm_emulator 安装成功。"></a>tpm_emulator 安装成功。</h3><hr>
<h1 id="5-安装TSS协议栈"><a href="#5-安装TSS协议栈" class="headerlink" title="5. 安装TSS协议栈"></a>5. 安装TSS协议栈</h1><p>这里指的是Trousers。Trousers是一个开源可信计算软件栈，它从下到上依次为TDDL（驱动库）、TCS（核心服务）、TSP（服务提供者），tcsd是编译完毕之后的一个用户态可执行文件，作为守护进程运行。tcsd需在系统启动初始化阶段运行，这样以后所有要操作tpm的程序都必须经过TSS栈，这也是TCG规范所规定的。TDDL负责唯一打开TPM设备，实现打开、关闭、收发指令数据、获取版本信息等，TCS提供核心服务，调用TDDL。TSP是给上层程序的接口，用户可以编写应用程序利用这些接口，实现操作TPM。<br>—<em>原创水印：<a href="https://gscsnm.github.io/" target="_blank" rel="noopener">https://gscsnm.github.io/</a></em>—</p>
<h3 id="5-1-安装trousers"><a href="#5-1-安装trousers" class="headerlink" title="5.1 安装trousers"></a>5.1 安装trousers</h3><p>下载地址：<br><a href="https://sourceforge.net/projects/trousers/files/" target="_blank" rel="noopener">https://sourceforge.net/projects/trousers/files/</a></p>
<p>下载3.14版本：<br> <a href="https://sourceforge.net/projects/trousers/files/trousers/0.3.14/trousers-0.3.14.tar.gz/download" target="_blank" rel="noopener">https://sourceforge.net/projects/trousers/files/trousers/0.3.14/trousers-0.3.14.tar.gz/download</a></p>
<p>5.1.1 解压：</p>
<pre><code>mkdir  trousers
cd trousers
tar -xzvf trousers-0.3.14.tar.gz  
</code></pre><p>5.1.2 安装依赖：</p>
<pre><code>看README：

  Packages needed to build:
  automake &gt; 1.4
  autoconf &gt; 1.4
  pkgconfig
  libtool
  gtk2-devel
  openssl-devel &gt;= 0.9.7
  pthreads library (glibc-devel)

挨个儿安装：  
用apt-get install 安装，可以先用apt-cahce search 搜索定位一下。  
能装多少就装多少吧，不装感觉也没事，没出错。
我安装了：
apt-get install -y automake1.9 autoconf2.64 pkgconf pkg-config libtool gtk2-engines openssl libssl-dev glibc-doc
</code></pre><p>5.1.3 编译安装前，需要把它的tddl库改成tpm_emulator提供的库，修改几个文件：</p>
<p>5.1.3.1 修改<code>./src/tcsd/Makefile.am</code>：</p>
<p> 第4行：</p>
<pre><code>tcsd_LDADD=${top_builddir}/src/tcs/libtcs.a ${top_builddir}/src/tcs/libtddl.so -lpthread @CRYPTOLIB@  
</code></pre><p>修改为：</p>
<pre><code>tcsd_LDADD=${top_builddir}/src/tcs/libtcs.a /usr/local/lib/libtddl.so -lpthread @CRYPTOLIB@
</code></pre><p>5.1.3.2 修改<code>./src/tcsd/Makefile.in</code>:<br>第55,56行：</p>
<pre><code>tcsd_DEPENDENCIES = ${top_builddir}/src/tcs/libtcs.a \
    ${top_builddir}/src/tddl/libtddl.a
</code></pre><p> 修改为：</p>
<pre><code>tcsd_DEPENDENCIES = ${top_builddir}/src/tcs/libtcs.a \
    /usr/local/lib/libtddl.so
</code></pre><p>注：上面修改中的<code>/usr/local/lib/</code>路径，需要根据libtddl.so文件位置决定。</p>
<p> 另：该版本文件夹中没有bootstrap，因此省略<code>sh bootstrap.sh</code>步骤</p>
<p>5.1.4 编译安装</p>
<pre><code>./configure
make
make install
</code></pre><p>问题：<br>1） <code>./configure</code>后报错：</p>
<pre><code>configure: error: openssl is currently the only supported crypto library for trousers.   
Please install openssl from http://www.openssl.org or the -devel package from your distro  
</code></pre><p>​     </p>
<p>解决：<br>安装openssl-devel：<br>​<br>    sudo apt-get install openssl<br>    sudo apt-get install libssl-dev</p>
<p>2）本来还有的，结果没记录。。(⊙﹏⊙)b   不过大家应该不会遇到。。</p>
<p>5.1.5 启动tcsd</p>
<p>先开一个终端，启动TPM_emulator。参考上文。<br>再开一个终端，启动tcsd。</p>
<pre><code>#tcsd -e -f
</code></pre><p>在启动TCSD之前，必须先启动tpm-emulator，否则会提示找不到设备.<br>如果提示如下，运行tpm的时候加上clear：<code>tpmd -f -d clear</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TCSD TDDL ioctl: (25) Inappropriate ioctl for device</span><br><span class="line">TCSD TDDL Falling back to Read/Write device support.</span><br><span class="line">TCSD TCS ERROR: TCS GetCapability failed with result = 0x1c</span><br></pre></td></tr></table></figure></p>
<h3 id="5-2-安装tpm-tools"><a href="#5-2-安装tpm-tools" class="headerlink" title="5.2 安装tpm-tools"></a>5.2 安装tpm-tools</h3><pre><code>apt-get install tpm-tools
</code></pre><h3 id="5-3-检测安装是否成功"><a href="#5-3-检测安装是否成功" class="headerlink" title="5.3 检测安装是否成功"></a>5.3 检测安装是否成功</h3><p>先开一个终端，启动TPM_emulator。参考上文。<br>再开一个终端，启动tcsd。参考上文。<br>再开一个终端，运行下面命令。</p>
<pre><code>在/usr/sbin目录下有3个关于tpm的命令运行如下
cd /usr/sbin
./tpm_version      #查看版本号
./tpm_getpubek   #查看ek公钥
./tpm_takeownership   #获取owner
</code></pre><p>注：如果都成功表明TPM模拟环境已经完全构建成功了。</p>
<h2 id="6-与TPM-emulator交互"><a href="#6-与TPM-emulator交互" class="headerlink" title="6 与TPM_emulator交互"></a>6 与TPM_emulator交互</h2><p>下载read.c 和 read_change.c文件，linux下编译运行。<br>下载地址：<a href="http://download.csdn.net/download/gscsnm/9898726" target="_blank" rel="noopener">http://download.csdn.net/download/gscsnm/9898726</a></p>
<p>步骤：<br>    1.一个终端运行TPM_emulator<br>    2.一个终端运行trousers<br>    3.在新开一个终端：</p>
<p>编译 read.c<br>        <code>gcc read.c -o read -ltspi</code><br>运行read<br>        <code>./read</code><br>如果报错：<br>    <code>./read: error while loading shared libraries: libtspi.so.1: cannot open shared object file: No such file or directory</code><br>    则需要添加    /usr/local/lib    到    /etc/ld.so.conf file :<br>    <code>echo &quot;/usr/local/lib&quot; &gt;&gt;/etc/ld.so.conf</code><br>    重新运行ok！<br>    read_change.c 一样~~</p>
<h2 id="7-安装过程中，错误记录（后补）"><a href="#7-安装过程中，错误记录（后补）" class="headerlink" title="7 安装过程中，错误记录（后补）"></a>7 安装过程中，错误记录（后补）</h2><h3 id="7-1-安装TPM-emulator"><a href="#7-1-安装TPM-emulator" class="headerlink" title="7.1 安装TPM_emulator"></a>7.1 安装TPM_emulator</h3><p>（树莓派3 Linux raspberrypi 4.9.35-v7+ 安装的使用遇到的问题 ）</p>
<p>1）make，到98%出错。<br>        —<em>原创水印：<a href="https://gscsnm.github.io/" target="_blank" rel="noopener">https://gscsnm.github.io/</a></em>—<br>    提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make[4]: *** /lib/modules/4.9.35-v7+/build: No such file or directory.  Stop.</span><br></pre></td></tr></table></figure></p>
<pre><code>不一定是 4.9.35-v7+ ，中间这个是你自己内核的版本号。可以用`uname -r `查看。
原因及解决办法：
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">查看该目录下是否有build：</span><br><span class="line">    cd /lib/modules/4.9.35-v7+/</span><br><span class="line">如果没有的话，再查看/usr/src下是否有linux-headers-*：</span><br><span class="line">    cd /usr/src</span><br><span class="line">如果没有linux-headers，那么安装linux-headers:</span><br><span class="line">安装这个请不要用国内的各大镜像，</span><br><span class="line">因为可能没有最新的linux-headers。</span><br><span class="line">我后来用树莓派安装tpm，</span><br><span class="line">版本是Linux raspberrypi 4.9.35-v7+，</span><br><span class="line">如果用国内的apt-get源安装的话，</span><br><span class="line">就没有对应的linux-headers。</span><br><span class="line">用`#deb-src http://archive.raspberrypi.org/debian/ jessie main ui`</span><br><span class="line">这个源进行安装linux-headers.</span><br><span class="line">	sudo apt-get install raspberrypi-kernel-headers</span><br></pre></td></tr></table></figure>
<p>重新 cmake  ，make install。<br>OK！</p>
<p>2）  make，到98%出错。<br>    —<em>原创水印：<a href="https://gscsnm.github.io/" target="_blank" rel="noopener">https://gscsnm.github.io/</a></em>—<br>    提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    Makefile:628: arch/armv7l/Makefile: No such file or directory</span><br><span class="line">make[4]: *** No rule to make target &apos;arch/armv7l/Makefile&apos;.  Stop.</span><br></pre></td></tr></table></figure></p>
<p>原因及解决办法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">因为我是用树莓派安装的，可能tpm没有针对 树莓派做特殊</span><br><span class="line">的makefile内容，至少是没有armv7l的，</span><br><span class="line">所以在make 和make install 的时候指定一</span><br><span class="line">下架构就行了。如下：</span><br><span class="line"></span><br><span class="line">   make ARCH=arm</span><br><span class="line">   make install ARCH=arm</span><br></pre></td></tr></table></figure>
<p>OK！</p>
<p>3）  make，到98%出错。<br>    —<em>原创水印：<a href="https://gscsnm.github.io/" target="_blank" rel="noopener">https://gscsnm.github.io/</a></em>—<br>    提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/home/pi/Desktop/tpm-emulator-master/build/tpmd_dev/linux/tpmd_dev.c: In function ‘tpmd_handle_command’:</span><br><span class="line">/home/pi/Desktop/tpm-emulator-master/build/tpmd_dev/linux/tpmd_dev.c:143:9: error: too many arguments to function ‘sock_recvmsg’</span><br><span class="line">   res = sock_recvmsg(tpmd_sock, &amp;msg, tpm_response.size, 0);</span><br><span class="line">         ^</span><br><span class="line">In file included from /home/pi/Desktop/tpm-emulator-master/build/tpmd_dev/linux/tpmd_dev.c:25:0:</span><br><span class="line">./include/linux/net.h:228:5: note: declared here</span><br><span class="line"> int sock_recvmsg(struct socket *sock, struct msghdr *msg, int flags);</span><br></pre></td></tr></table></figure></p>
<p>原因及解决办法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">提示说</span><br><span class="line">error: too many arguments to function ‘sock_recvmsg’，</span><br><span class="line">说明源码里sock_recvmsg函数不适配这个linux 内核版本。</span><br><span class="line">也就是说这个linux内核提供的sock_recvmsg函数与</span><br><span class="line">源码里用的不一致~~</span><br><span class="line"> 都是树莓派的锅哈哈哈。。</span><br><span class="line"> 我下了个原版的tmp_emulator源码，然后make就过了。</span><br><span class="line"> 地址： [http://download.csdn.net/download/gscsnm/9898586](csdn下载)~~</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/tpm-emulator-可信计算/" rel="tag"># tpm_emulator 可信计算</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/20/【qemu-kvm-libvirt系列】libvirt问题集合/" rel="next" title="【qemu-kvm & libvirt系列】libvirt问题集合">
                <i class="fa fa-chevron-left"></i> 【qemu-kvm & libvirt系列】libvirt问题集合
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/shinubi.jpg"
                alt="い十指演绎生活〃" />
            
              <p class="site-author-name" itemprop="name">い十指演绎生活〃</p>
              <p class="site-description motion-element" itemprop="description">慎独</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-序"><span class="nav-number">1.</span> <span class="nav-text">0. 序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-环境"><span class="nav-number">2.</span> <span class="nav-text">1. 环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-安装cmake"><span class="nav-number">3.</span> <span class="nav-text">2. 安装cmake</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-安装GNU-MP-library"><span class="nav-number">4.</span> <span class="nav-text">3. 安装GNU MP library</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-apt-get-安装-（推荐）"><span class="nav-number">4.0.1.</span> <span class="nav-text">3.1 apt-get 安装 （推荐）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-源码安装"><span class="nav-number">4.0.2.</span> <span class="nav-text">3.2 源码安装</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-安装TPM-emulator"><span class="nav-number">5.</span> <span class="nav-text">4. 安装TPM_emulator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-下载"><span class="nav-number">5.0.1.</span> <span class="nav-text">4.1 下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-解压"><span class="nav-number">5.0.2.</span> <span class="nav-text">4.2 解压</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-安装"><span class="nav-number">5.0.3.</span> <span class="nav-text">4.3 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-初始化、启动TPM-emulator"><span class="nav-number">5.0.4.</span> <span class="nav-text">4.4 初始化、启动TPM_emulator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tpm-emulator-安装成功。"><span class="nav-number">5.0.5.</span> <span class="nav-text">tpm_emulator 安装成功。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-安装TSS协议栈"><span class="nav-number">6.</span> <span class="nav-text">5. 安装TSS协议栈</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-安装trousers"><span class="nav-number">6.0.1.</span> <span class="nav-text">5.1 安装trousers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-安装tpm-tools"><span class="nav-number">6.0.2.</span> <span class="nav-text">5.2 安装tpm-tools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-检测安装是否成功"><span class="nav-number">6.0.3.</span> <span class="nav-text">5.3 检测安装是否成功</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-与TPM-emulator交互"><span class="nav-number">6.1.</span> <span class="nav-text">6 与TPM_emulator交互</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-安装过程中，错误记录（后补）"><span class="nav-number">6.2.</span> <span class="nav-text">7 安装过程中，错误记录（后补）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-安装TPM-emulator"><span class="nav-number">6.2.1.</span> <span class="nav-text">7.1 安装TPM_emulator</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">い十指演绎生活〃</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
